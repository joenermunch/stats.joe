{"version":3,"sources":["Components/App.js","index.js"],"names":["App","state","username","images","stats","loading","download","tweet","callAPI","e","a","preventDefault","setState","axios","post","response","mappedImages","data","topalbums","album","map","image","mappedStats","artist","name","playcount","mappedArtists","join","makeImage","html2canvas","document","querySelector","allowTaint","useCORS","scrollX","scrollY","then","canvas","createElement","href","toDataURL","replace","click","renderDownload","className","onClick","renderImages","style","background","key","renderTopText","renderTweet","window","twttr","d","s","id","js","fjs","getElementsByTagName","t","getElementById","src","parentNode","insertBefore","_e","ready","f","push","class","renderLoading","onSubmit","placeholder","type","onChange","target","value","this","Component","ReactDOM","render"],"mappings":"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","file":"static/js/main.b89a392f.chunk.js","sourcesContent":["import React, {Component} from \"react\";\r\nimport axios from \"axios\";\r\nimport \"./style.css\";\r\nimport html2canvas from \"html2canvas\";\r\nimport canvasToImage from \"canvas-to-image\";\r\n\r\nexport class App extends Component {\r\n  state = {\r\n    username: null,\r\n    images: null,\r\n    stats: null,\r\n    loading: false,\r\n    download: false,\r\n    tweet: null\r\n  };\r\n\r\n  callAPI = async e => {\r\n    e.preventDefault();\r\n    this.setState({loading: true});\r\n    const response = await axios.post(\"/api/data\", {\r\n      username: this.state.username\r\n    });\r\n\r\n    const mappedImages = response.data.topalbums.album.map(album => {\r\n      return album.image[2][\"#text\"];\r\n    });\r\n\r\n    const mappedStats = response.data.topalbums.album.map(album => {\r\n      return {\r\n        artist: album.artist.name,\r\n        album: album.name,\r\n        playcount: album.playcount,\r\n        image: album.image[2][\"#text\"]\r\n      };\r\n    });\r\n\r\n    this.setState({\r\n      images: mappedImages,\r\n      stats: mappedStats,\r\n      loading: false,\r\n      download: true\r\n    });\r\n\r\n    const mappedArtists = this.state.stats.map(artist => {\r\n      return `${artist.artist} (${artist.playcount})`;\r\n    });\r\n\r\n    this.setState({\r\n      tweet: mappedArtists.join(`, `)\r\n    });\r\n  };\r\n\r\n  makeImage = async () => {\r\n    await html2canvas(document.querySelector(\"#capture\"), {\r\n      allowTaint: true,\r\n      useCORS: true,\r\n      scrollX: 0,\r\n      scrollY: 0\r\n    }).then(canvas => {\r\n      var a = document.createElement(\"a\");\r\n\r\n      a.href = canvas\r\n        .toDataURL(\"image/jpeg\")\r\n        .replace(\"image/jpeg\", \"image/octet-stream\");\r\n      a.download = \"mytopalbums.jpg\";\r\n      a.click();\r\n    });\r\n  };\r\n\r\n  renderDownload = () => {\r\n    if (this.state.download === true) {\r\n      return (\r\n        <button className=\"download-button\" onClick={this.makeImage}>\r\n          Download\r\n        </button>\r\n      );\r\n    } else return <></>;\r\n  };\r\n\r\n  renderImages = () => {\r\n    if (this.state.stats) {\r\n      return this.state.stats.map(artist => {\r\n        return (\r\n          <div\r\n            style={{background: `url(${artist.image})`}}\r\n            key={artist.image}\r\n            className=\"image-item\"\r\n          >\r\n            <div className=\"stats\">\r\n              <p>{artist.artist}</p>\r\n              <p className=\"album\">{artist.album}</p>\r\n              <p className=\"plays\">{artist.playcount} plays</p>\r\n            </div>\r\n          </div>\r\n        );\r\n      });\r\n    } else return <></>;\r\n  };\r\n\r\n  renderTopText = () => {\r\n    if (this.state.stats) {\r\n      return (\r\n        <div className=\"text-container\">\r\n          My top artists of the week: {this.state.tweet} #stats.joe\r\n        </div>\r\n      );\r\n    } else return <></>;\r\n  };\r\n\r\n  renderTweet = () => {\r\n    if (this.state.stats) {\r\n      window.twttr = (function(d, s, id) {\r\n        var js,\r\n          fjs = d.getElementsByTagName(s)[0],\r\n          t = window.twttr || {};\r\n        if (d.getElementById(id)) return t;\r\n        js = d.createElement(s);\r\n        js.id = id;\r\n        js.src = \"https://platform.twitter.com/widgets.js\";\r\n        fjs.parentNode.insertBefore(js, fjs);\r\n\r\n        t._e = [];\r\n        t.ready = function(f) {\r\n          t._e.push(f);\r\n        };\r\n\r\n        return t;\r\n      })(document, \"script\", \"twitter-wjs\");\r\n\r\n      return (\r\n        <a\r\n          class=\"twitter-share-button\"\r\n          href={`https://twitter.com/intent/tweet?text=My top artists of the week: ${this.state.tweet} #joe.io`}\r\n        >\r\n          Tweet\r\n        </a>\r\n      );\r\n    } else return <></>;\r\n  };\r\n\r\n  renderLoading = () => {\r\n    if (this.state.loading === true) {\r\n      return <p className=\"loading\">Loading...</p>;\r\n    } else return this.renderDownload();\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div>\r\n        <div className=\"main-container\">\r\n          <header>\r\n            <form onSubmit={e => this.callAPI(e)}>\r\n              <h1 className=\"title\">stats.joe</h1>\r\n              <input\r\n                placeholder=\"Last.FM username\"\r\n                type=\"text\"\r\n                onChange={e => this.setState({username: e.target.value})}\r\n              />\r\n              <button className=\"submit-button\" onClick={this.callAPI}>\r\n                Generate collage\r\n              </button>\r\n              <div className=\"result\">{this.renderLoading()}</div>\r\n            </form>\r\n          </header>\r\n          <div className=\"image-main\">\r\n            <div className=\"image-container\">\r\n              <div className=\"image-box\" id=\"capture\">\r\n                {this.renderImages()}\r\n              </div>\r\n              <div className=\"text-tweet\">\r\n                {this.renderTopText()}\r\n                {this.renderTweet()}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <footer className=\"header-footer\">\r\n          <p className=\"footer-text\">\r\n            made with <span className=\"heart\">❤️</span> and React by{\" \"}\r\n            <a\r\n              className=\"github\"\r\n              target=\"_BLANK\"\r\n              href=\"https://github.com/joenermunch\"\r\n            >\r\n              joener münch\r\n            </a>\r\n          </p>\r\n          <p>\r\n            <a\r\n              className=\"source\"\r\n              target=\"_BLANK\"\r\n              href=\"https://github.com/joenermunch/stats.joe\"\r\n            >\r\n              source code\r\n            </a>\r\n          </p>\r\n        </footer>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./Components/App\";\r\n\r\nReactDOM.render(<App />, document.querySelector(\"#root\"));\r\n"],"sourceRoot":""}